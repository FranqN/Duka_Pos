{% extends "base.html" %}
{% block title %}Admin Dashboard - Duka{% endblock %}
{% block content %}
<div class="container-fluid">
    <h1 class="mb-4 text-center">Admin Dashboard</h1>
    <!-- Summary Cards -->
    <div class="row g-3 mb-4">
        <div class="col-6 col-md-2">
            <div class="card text-bg-primary shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-box-seam display-6"></i>
                    <h6 class="mt-2">Products</h6>
                    <div class="display-6 fw-bold">{{ total_products }}</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-2">
            <div class="card text-bg-success shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-people display-6"></i>
                    <h6 class="mt-2">Users</h6>
                    <div class="display-6 fw-bold">{{ total_users }}</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-2">
            <div class="card text-bg-warning shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-currency-dollar display-6"></i>
                    <h6 class="mt-2">Sales</h6>
                    <div class="display-6 fw-bold">{{ total_sales }}</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-2">
            <div class="card text-bg-info shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-cash-coin display-6"></i>
                    <h6 class="mt-2">Expenses</h6>
                    <div class="display-6 fw-bold">{{ total_expenses }}</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-2">
            <div class="card text-bg-success shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-graph-up-arrow display-6"></i>
                    <h6 class="mt-2">Profit</h6>
                    <div class="display-6 fw-bold">{{ cash_flow[-1]['profit'] if cash_flow else 0 }}</div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-2">
            <div class="card text-bg-danger shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-exclamation-triangle display-6"></i>
                    <h6 class="mt-2">Low Stock</h6>
                    <div class="display-6 fw-bold">{{ low_stock_products|length }}</div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-6">
            <div class="accordion" id="dashboardAccordionLeft">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingSalesTrends">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSalesTrends" aria-expanded="true" aria-controls="collapseSalesTrends">
                            <i class="bi bi-graph-up me-2"></i> Sales Trends
                        </button>
                    </h2>
                    <div id="collapseSalesTrends" class="accordion-collapse collapse show" aria-labelledby="headingSalesTrends" data-bs-parent="#dashboardAccordionLeft">
                        <div class="accordion-body p-0">
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Date</th>
                                            <th>Sales</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for date, sales in sales_trends %}
                                        <tr>
                                            <td>{{ date }}</td>
                                            <td>{{ sales }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingInventoryValue">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInventoryValue" aria-expanded="false" aria-controls="collapseInventoryValue">
                            <i class="bi bi-box-seam me-2"></i> Inventory Value Over Time
                        </button>
                    </h2>
                    <div id="collapseInventoryValue" class="accordion-collapse collapse" aria-labelledby="headingInventoryValue" data-bs-parent="#dashboardAccordionLeft">
                        <div class="accordion-body p-0">
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Date</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for date, value in inventory_value %}
                                        <tr>
                                            <td>{{ date }}</td>
                                            <td>{{ value }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTopProducts">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTopProducts" aria-expanded="false" aria-controls="collapseTopProducts">
                            <i class="bi bi-star me-2"></i> Top Categories/Products by Sales
                        </button>
                    </h2>
                    <div id="collapseTopProducts" class="accordion-collapse collapse" aria-labelledby="headingTopProducts" data-bs-parent="#dashboardAccordionLeft">
                        <div class="accordion-body p-0">
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Product</th>
                                            <th>Units Sold</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for product, units in top_products %}
                                        <tr>
                                            <td>{{ product }}</td>
                                            <td>{{ units }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="accordion" id="dashboardAccordionRight">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingPaymentMethods">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePaymentMethods" aria-expanded="true" aria-controls="collapsePaymentMethods">
                            <i class="bi bi-credit-card me-2"></i> Payment Method Breakdown
                        </button>
                    </h2>
                    <div id="collapsePaymentMethods" class="accordion-collapse collapse show" aria-labelledby="headingPaymentMethods" data-bs-parent="#dashboardAccordionRight">
                        <div class="accordion-body p-0">
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Method</th>
                                            <th>Payments</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for method, payments in payment_methods %}
                                        <tr>
                                            <td>{{ method }}</td>
                                            <td>{{ payments }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingSupplierInsights">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSupplierInsights" aria-expanded="false" aria-controls="collapseSupplierInsights">
                            <i class="bi bi-truck me-2"></i> Supplier Insights
                        </button>
                    </h2>
                    <div id="collapseSupplierInsights" class="accordion-collapse collapse" aria-labelledby="headingSupplierInsights" data-bs-parent="#dashboardAccordionRight">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Recent Supplier Orders</h6>
                                    <ul class="list-group mb-3">
                                        {% for order in recent_supplier_orders %}
                                        <li class="list-group-item">
                                            {{ order.supplier.name }} - {{ order.product.name }} ({{ order.quantity }}) - {{ order.status }}
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6>Outstanding Payments</h6>
                                    <ul class="list-group mb-3">
                                        {% for supplier, amount in outstanding_payments %}
                                        <li class="list-group-item">
                                            {{ supplier.name }}: <span class="badge bg-danger">{{ amount }}</span>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                            <h6>Supplier Performance</h6>
                            <div class="table-responsive">
                                <table class="table table-bordered table-sm">
                                    <thead>
                                        <tr>
                                            <th>Supplier</th>
                                            <th>Total Supplied</th>
                                            <th>On-Time Delivery (%)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for perf in supplier_performance %}
                                        <tr>
                                            <td>{{ perf['name'] }}</td>
                                            <td>{{ perf['total_supplied'] }}</td>
                                            <td>{{ perf['on_time_percent'] }}%</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingCashFlow">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCashFlow" aria-expanded="false" aria-controls="collapseCashFlow">
                            <i class="bi bi-cash-stack me-2"></i> Cash Flow Summary
                        </button>
                    </h2>
                    <div id="collapseCashFlow" class="accordion-collapse collapse" aria-labelledby="headingCashFlow" data-bs-parent="#dashboardAccordionRight">
                        <div class="accordion-body p-0">
                            <div class="table-responsive">
                                <table class="table table-bordered mb-0">
                                    <thead>
                                        <tr>
                                            <th>Month</th>
                                            <th>Revenue</th>
                                            <th>Expenses</th>
                                            <th>Profit</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in cash_flow %}
                                        <tr>
                                            <td>{{ row['month'] }}</td>
                                            <td>{{ row['revenue'] }}</td>
                                            <td>{{ row['expenses'] }}</td>
                                            <td>{{ row['profit'] }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}